<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>交叉口的轨迹规划的一些探索 | 57D02</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.C9uRB-6s.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CE13IwWx.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Cmg0thDS.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B4b5TrON.js">
    <link rel="modulepreload" href="/assets/posts_交叉口的轨迹规划的一些探索.md.xDbVEZE2.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="main-layout"><div class="navbar-container"><nav class="navbar"><div class="brand-group"><a class="brand-logo" href="/"><img src="https://resource-un4.pages.dev/article/yjtp.webp" alt="avatar"></a><a class="brand-text" href="/">57D02</a></div><div class="search-container"><div class="search-input"><input type="text" placeholder="动物怎么叫" class="search-field"><i class="fa-solid fa-magnifying-glass search-icon"></i></div></div><div class="menu-group"><!--[--><div class="el-dropdown"><!--[--><h3 class="menu-fitem el-tooltip__trigger el-tooltip__trigger" id="el-id-4712-234" role="button" tabindex="0" aria-controls="el-id-4712-235" aria-expanded="false" aria-haspopup="menu"><span><i class="fal fa-browser"></i> 我的网址 <i class="fa-light fa-angle-up arrow-icon"></i></span></h3><!--teleport start--><!--teleport end--><!--]--><!--v-if--></div><div class="el-dropdown"><!--[--><h3 class="menu-fitem el-tooltip__trigger el-tooltip__trigger" id="el-id-4712-238" role="button" tabindex="0" aria-controls="el-id-4712-239" aria-expanded="false" aria-haspopup="menu"><span><i class="fa-solid fa-list"></i> 更多功能 <i class="fa-light fa-angle-up arrow-icon"></i></span></h3><!--teleport start--><!--teleport end--><!--]--><!--v-if--></div><!--]--></div></nav></div><div class="el-scrollbar"><div class="el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style="overflow-x:hidden;height:100vh;"><div class="el-scrollbar__view" style=""><!--[--><!----><div class="content-container"><div id="post-info"><div class="article-header" data-v-7d61ea6a><div class="header-title" data-v-7d61ea6a><h1 data-v-7d61ea6a>交叉口的轨迹规划的一些探索</h1></div><div class="meta-info" data-v-7d61ea6a><div class="author-info" data-v-7d61ea6a><i class="fa-light fa-user" data-v-7d61ea6a></i><span class="author" data-v-7d61ea6a>57D02</span></div><div class="divider" data-v-7d61ea6a></div><div class="date-info" data-v-7d61ea6a><i class="fa-light fa-calendar" data-v-7d61ea6a></i><time datetime="2024-10-23T20:34:45.000Z" data-v-7d61ea6a>2024年10月24日</time></div></div></div></div><div class="page-wrapper"><div class="page-card vp-doc"><div style="position:relative;"><div><h2 id="交叉口的轨迹规划的一些探索" tabindex="-1">交叉口的轨迹规划的一些探索 <a class="header-anchor" href="#交叉口的轨迹规划的一些探索" aria-label="Permalink to &quot;交叉口的轨迹规划的一些探索&quot;">​</a></h2><h3 id="地图的感知-理解和车辆的定位" tabindex="-1">地图的感知，理解和车辆的定位 <a class="header-anchor" href="#地图的感知-理解和车辆的定位" aria-label="Permalink to &quot;地图的感知，理解和车辆的定位&quot;">​</a></h3><h4 id="frenet坐标系" tabindex="-1">Frenet坐标系 <a class="header-anchor" href="#frenet坐标系" aria-label="Permalink to &quot;Frenet坐标系&quot;">​</a></h4><p>​ 车辆一般沿着车道行驶，车道有曲有直。驾驶人不会根据GPS的坐标直接控制车辆，而是根据车辆和车道的相对位置进行调整。Frenet坐标系提供了一种相对于路径的局部坐标表示。这种表示使得在曲线路径上进行导航和控制更为直观，能够简化计算，尤其在处理车辆或机器人在复杂环境中的运动时，能够有效地处理加速度、速度和方向的变化。将曲线车道通过Frenet坐标系转化为直道后，可以通过一种统一的方式规划车辆在这条车道上的轨迹。</p><p><img src="https://resource-un4.pages.dev/article/image-20241023192511211.png" alt="十字路口的左转车道"></p><p>取其中某一条左转车道</p><p><img src="https://resource-un4.pages.dev/article/99f21b22596e38e627bbfe1d7c12281.png" alt="cartesian下的左转车道"></p><p>化曲为直后。</p><p><img src="https://resource-un4.pages.dev/article/f81974d941ceca5c06d6bff87514dd0.png" alt="Frenent下左转车道"></p><h4 id="地图离散化" tabindex="-1">地图离散化 <a class="header-anchor" href="#地图离散化" aria-label="Permalink to &quot;地图离散化&quot;">​</a></h4><p>对于需要进行避让的车辆（下以控制车辆表示），以其所在的车道道路中心线为参考线建立Frenet坐标系后，对控制车辆前方的道路中线进行离散化采样：</p><h5 id="初次采样" tabindex="-1">初次采样 <a class="header-anchor" href="#初次采样" aria-label="Permalink to &quot;初次采样&quot;">​</a></h5><p><img src="https://resource-un4.pages.dev/article/3f3c068b5c6e4d51aa16c0216d79d62.jpg" alt="初采样"></p><p>将规划的距离加长，但只对远距离的情况进行预测，故少量采样。</p><p>近距离的规划即将要执行控制，因此对近距离的轨迹需要更加细致的采样。</p><p>最终的采样是近多远少，间隔递增的。例如：在控制车辆前方 0.5 1 1.5 2.5 4.5 8.5 14.5 m分别采样。</p><h5 id="再次采样" tabindex="-1">再次采样 <a class="header-anchor" href="#再次采样" aria-label="Permalink to &quot;再次采样&quot;">​</a></h5><p>中线采样后，沿着中线采样点横向扩展，如图：</p><p><img src="https://resource-un4.pages.dev/article/e1f55e54b8338defe6772d47ec9cf1a.jpg" alt="再次采样"></p><h3 id="成本计算" tabindex="-1">成本计算 <a class="header-anchor" href="#成本计算" aria-label="Permalink to &quot;成本计算&quot;">​</a></h3><h5 id="人工势场法" tabindex="-1">人工势场法 <a class="header-anchor" href="#人工势场法" aria-label="Permalink to &quot;人工势场法&quot;">​</a></h5><p>通过人工势场让车辆认识的需要避开什么，需要遵循什么。</p><p><strong>1. 对车辆建立排斥势场：</strong></p><p>对车前后杠建立势场（认为车的前后都是比较危险的位置，让他们的前后势场高）</p><p>这里采用高斯势场函数</p><p>高斯函数在人工势场方法中常用于生成吸引力和排斥力。其数学表达式通常为：</p><p>$$ U(x) = A \cdot e^{-\frac{(x - x_0)^2}{2\sigma^2}} $$</p><ul><li><p>$$ U(x) 是在点 x 处的势能。 $$</p></li><li><p>$$ A 是势能的幅度（影响强度）。 $$</p></li><li><p>$$ x_0 是高斯函数的中心点（目标位置）。 $$</p></li><li><p>$$ \sigma是标准差，决定了势能的宽度。 $$</p></li></ul><p><strong>伪代码示例</strong></p><div class="language-plaintext vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>function gaussian_potential(x, A, x0, sigma):</span></span>
<span class="line"><span>    exponent = -(x - x0)^2 / (2 * sigma^2)</span></span>
<span class="line"><span>    potential = A * exp(exponent)</span></span>
<span class="line"><span>    return potential</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 使用示例</span></span>
<span class="line"><span>A = 1.0          // 幅度</span></span>
<span class="line"><span>x0 = target_position // 目标位置</span></span>
<span class="line"><span>sigma = 1.0      // 标准差</span></span>
<span class="line"><span></span></span>
<span class="line"><span>for each position in positions:</span></span>
<span class="line"><span>    U = gaussian_potential(position, A, x0, sigma)</span></span>
<span class="line"><span>    // 使用U进行路径规划或控制</span></span></code></pre></div><p><strong>2. 车道中心线吸引势场</strong></p><p>使车辆尽可能沿着车道中心线行驶</p><p><strong>3. 其他车辆移动的势场预测</strong></p><p><img src="https://resource-un4.pages.dev/article/image-20241023202057114.png" alt="车辆势场"></p><h5 id="转向成本" tabindex="-1">转向成本 <a class="header-anchor" href="#转向成本" aria-label="Permalink to &quot;转向成本&quot;">​</a></h5><p>转向尽可能避免急转，对路径前后点之间的转弯角度进行惩罚，禁止超出最大转弯角。角度的计算见后文车辆控制理论。</p><h4 id="车辆控制理论" tabindex="-1">车辆控制理论： <a class="header-anchor" href="#车辆控制理论" aria-label="Permalink to &quot;车辆控制理论：&quot;">​</a></h4><h5 id="pure-pursuit-纯追踪法" tabindex="-1">pure pursuit 纯追踪法： <a class="header-anchor" href="#pure-pursuit-纯追踪法" aria-label="Permalink to &quot;pure pursuit 纯追踪法：&quot;">​</a></h5><blockquote><p>Pure Pursuit方法，顾名思义，纯轨迹跟踪。它是一种基于几何追踪的路径跟随算法，由Craig Coulter于1992年提出。因控制方法较为简单且直接，无须过多考虑车辆的运动学与<a href="https://zhida.zhihu.com/search?content_id=220718048&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%A8%A1%E5%9E%8B&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3Mjk4NTc1ODAsInEiOiLliqjlipvlrabmqKHlnosiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjA3MTgwNDgsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.G7NdYXCtfJPEQC7vd8IHNRcFk56lqAXPdyc3JqeTu_E&amp;zhida_source=entity" target="_blank" rel="noreferrer">动力学模型</a>，且调节参数少，可适用于自动驾驶车辆或移动机器人中。</p></blockquote><p>Pure Pursuit算法的基本思想是：参考人类驾驶的行为，通过计算车辆当前位置到预瞄点（goal point）的曲率，使车辆沿着经过预瞄点的圆弧行驶，从而实现轨迹跟踪(如图1)。因此，该算法的核心在于通过设计合理的<a href="https://zhida.zhihu.com/search?content_id=220718048&amp;content_type=Article&amp;match_order=1&amp;q=%E9%A2%84%E7%9E%84%E8%B7%9D%E7%A6%BB&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3Mjk4NTc1ODAsInEiOiLpooTnnoTot53nprsiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjA3MTgwNDgsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.51r_le0proaKahq_6TbVF2LVzqVUMunQzRrYOCQX8nM&amp;zhida_source=entity" target="_blank" rel="noreferrer">预瞄距离</a>，从而计算出轨迹跟踪的控制曲率。</p><p><img src="https://resource-un4.pages.dev/article/image-20241023203621670.png" alt="fig1"></p><ol><li><p><strong>预瞄距离计算</strong> (Lookahead Distance, $ L_d $)： $$ L_d = \sqrt{(x_g - x_v)^2 + (y_g - y_v)^2} $$ 其中，$ (x_v, y_v) $ 是车辆当前的位置，$ (x_g, y_g) $ 是预瞄点的坐标。</p></li><li><p><strong>目标角度</strong> ($\alpha$) 的计算： $$ \alpha = \arctan\left(\frac{y_g - y_v}{x_g - x_v}\right) - \theta_v $$ 其中，$ \theta_v $ 是车辆当前的朝向角。</p></li><li><p><strong>轨迹曲率</strong> ($ \kappa $) 与转向角 ($ \delta $) 的关系： $$ \delta = \arctan\left(\frac{L \cdot \kappa}{L_d}\right) $$ 由于 $ \kappa = \frac{1}{R} $，其中 $ R $ 是车辆转向时的曲率半径，我们可以得到： $$ \delta = \arctan\left(\frac{2L \sin(\alpha)}{L_d}\right) $$ 这里，$ L $ 是车辆的轴距。</p></li><li><p><strong>预瞄距离的动态调整</strong>： 预瞄距离 $ L_d $ 可以是一个固定值，也可以随着车辆速度变化动态调整。一种常见的方法是将预瞄距离表示为车辆纵向速度的线性函数： $$ L_d = k_v \cdot v + l_0 $$ 其中，$ k_v $ 是速度比例因子，$ v $ 是车辆的速度，$ l_0 $ 是最小预瞄距离。</p></li><li><p><strong>方向盘转角的计算</strong></p></li><li><p>阿克曼转向几何关系： $$ \tan(\delta) = \frac{L}{R} $$ 其中，δ 是前轮转角，$ L $ 是车辆轴距，$ R $ 是车辆转向时的曲率半径。</p></li><li><p>方向盘转角输入量 $ \text{steering} $ 与跟踪曲率 $ K $ 之间的关系： $$ \text{steering} = K \cdot \tan^{-1}\left(\frac{L}{R}\right) $$</p></li><li><p>方向盘角度、横向误差以及预瞄距离之间的关系： $$ \text{steering} = K \cdot \tan^{-1}\left(\frac{2L \sin(\alpha)}{L_d}\right) $$ 其中，$ K $ 是车辆转向传动比，$α$ 是目标角度，$ L_d $ 是预瞄距离。</p></li></ol><h3 id="a-算法进行路径规划" tabindex="-1">A* 算法进行路径规划 <a class="header-anchor" href="#a-算法进行路径规划" aria-label="Permalink to &quot;A* 算法进行路径规划&quot;">​</a></h3><p>​ 经过上述操作后，可以开始对单辆车进行轨迹规划了。</p><ol><li>将所有的采样点进行排列组合，得到所有能够机械上允许的路径。从路径中选取成本最低的路径进行碰撞判断。</li></ol><p>​ 这其实是自动驾驶汽车巡航的经典算法——Lattice规划 采用的方式。但这个算法效率不足。</p><ol start="2"><li>使用传统的最短路算法Dijkstra</li><li>使用A*算法，以到达道路尽头（s 增大）为启发，成本函数由 势场成本 + 行动成本（包括打方向盘的角度等）构成。</li></ol><p>显而易见的是，1方法虽然精度高，但显然效率不足，Dijkstra方法效率依旧不如A*。下图是Dijkstra算法和A*算法效率比较：</p><p><strong>无障碍物</strong></p><p><img src="https://resource-un4.pages.dev/article/d7c90df607841d59a48b5672c5c1508a.gif" alt="nobarrier"></p><p><strong>有障碍物</strong></p><p><img src="https://resource-un4.pages.dev/article/b383d524eb518bab0c1f0a14dc1ce1f5_4.gif" alt="barrier"></p></div></div></div><div class="sidebar"><div class="profile-card has-border"><div class="avatar-wrapper"><img src="https://resource-un4.pages.dev/article/yjtp.webp" alt="57D02" class="avatar"></div><div class="profile-content"><h2 class="name">57D02</h2><div class="position">全栈开发、优化算法爱好者</div><p class="bio">呜呜呜呜呜呜</p><div class="social-links"><!--[--><a href="https://github.com/57Darling02/" target="_blank" class="social-item" title="GitHub"><i class="fa-brands fa-github"></i></a><a href="57Darling02@outlook.com" target="_blank" class="social-item" title="邮箱"><i class="fa-regular fa-envelope"></i></a><!--]--></div></div></div><div class="sidebar-stay"><div class="toc-card" data-v-a1666ab9><i class="fas fa-columns" data-v-a1666ab9></i><span class="toc-title" style="font-weight:600;" data-v-a1666ab9>目录导航</span><div class="el-scrollbar" data-v-a1666ab9><div class="el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style=""><div class="el-scrollbar__view" style=""><!--[--><div class="empty-tip" data-v-a1666ab9>暂无目录</div><!--]--></div></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:;transform:translateY(0%);"></div></div><!--]--></div></div><!----></div></div></div></div><div class="footer-container" style="color:white;"><Badge type="tip">Copyright © 2025-present 57D02</Badge></div><!--]--></div></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:;transform:translateY(0%);"></div></div><!--]--></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_index.md\":\"BXn1AeTD\",\"index.md\":\"BuxDNdUi\",\"posts_20240916-2.md\":\"qXz9xXdf\",\"posts_20240916.md\":\"Cen_2V7f\",\"posts_20240923.md\":\"DAEEFOEx\",\"posts_20241026_无眠夜.md\":\"mRCAaeIp\",\"posts_51stc_uart.md\":\"C8WhIvzO\",\"posts_cloudflare_free.md\":\"5KsxQB8V\",\"posts_columngeneration.md\":\"BkkART46\",\"posts_ftp.md\":\"Cpux9fJh\",\"posts_hahha.md\":\"BBm_T87b\",\"posts_hello-world.md\":\"C3NzfzEN\",\"posts_hexo快速创作指南.md\":\"Cudi9z-k\",\"posts_ksweb.md\":\"C-Q2s2ds\",\"posts_sao-uw-1.md\":\"B9AXICYl\",\"posts_sao-uw-2.md\":\"Dzmhcj3w\",\"posts_sao-uw-3.md\":\"csZI7z0q\",\"posts_sao-uw-4.md\":\"y2XCA12O\",\"posts_sao-uw-5.md\":\"C1IkThxM\",\"posts_sao-uw-6.md\":\"XdBEHyDN\",\"posts_sao-uw-7.md\":\"CSU_CSRV\",\"posts_sao-uw-8.md\":\"COUh4tH3\",\"posts_search_method2.md\":\"BFrPojzr\",\"posts_searchmethod.md\":\"AypBoSae\",\"posts_searchmethods3.md\":\"B2kMEo_n\",\"posts_交叉口的轨迹规划的一些探索.md\":\"xDbVEZE2\",\"posts_单纯形法.md\":\"CYalUIwv\",\"posts_如何写一篇hexo博客.md\":\"UFJ0G-X5\",\"posts_嵌入式学习.md\":\"CHNIKTSt\",\"posts_我家邻居蛇精病.md\":\"B4oovZt2\",\"posts_生产工具.md\":\"DRdw0RLl\",\"posts_运筹线性规划.md\":\"DM0khA-z\",\"posts_逆向初体验.md\":\"D67P5eLB\",\"posts_钟情.md\":\"CD2A2lW-\",\"readme.md\":\"DVOXxAtU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"57D02\",\"description\":\"A VitePress Site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"bgImage\":{\"src\":\"\",\"alt\":\"57D02\"},\"mainTitle\":\"57D02\",\"subTitles\":[\"全栈开发爱好者\",\"算法优化爱好者\",\"软件开发爱好者\",\"安卓与嵌入式开发爱好者\"],\"defaultauthor\":\"57D02\",\"logo\":\"https://resource-un4.pages.dev/article/yjtp.webp\",\"siteTitle\":\"57D02\",\"menuItems\":[{\"label\":\"我的网址\",\"icon\":\"fal fa-browser\",\"children\":[{\"key\":\"action1\",\"label\":\"闪装智拼\",\"icon\":\"fas fa-cubes\",\"link\":\"https://box.57d02.cn\"},{\"key\":\"action2\",\"label\":\"alist云盘\",\"icon\":\"fa-solid fa-square\",\"link\":\"https://alist.57d02.cn\"}]},{\"label\":\"更多功能\",\"icon\":\"fa-solid fa-list\",\"children\":[{\"key\":\"action1\",\"label\":\"404测试\",\"icon\":\"fa-solid fa-circle\",\"link\":\"404\"},{\"key\":\"action2\",\"label\":\"关于\",\"icon\":\"fa-solid fa-square\",\"link\":\"about/index\"},{\"key\":\"action3\",\"label\":\"归档\",\"icon\":\"fa-solid fa-star\",\"link\":\"posts/hahha\"}]}],\"avatar\":\"https://resource-un4.pages.dev/article/yjtp.webp\",\"name\":\"57D02\",\"position\":\"全栈开发、优化算法爱好者\",\"bio\":\"呜呜呜呜呜呜\",\"socialLinks\":[{\"name\":\"GitHub\",\"icon\":\"fa-brands fa-github\",\"url\":\"https://github.com/57Darling02/\"},{\"name\":\"邮箱\",\"icon\":\"fa-regular fa-envelope\",\"url\":\"57Darling02@outlook.com\"}],\"footer\":{\"message\":\"VitePress\",\"copyright\":\"Copyright © 2025-present 57D02\"},\"lastUpdated\":{\"text\":\"Updated at\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>